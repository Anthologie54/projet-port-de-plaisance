<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Tableau de bord - Port Russell</title>
</head>
<body>
  <h1>Tableau de bord</h1>
  <p>Bienvenue sur votre tableau de bord !</p>

  <h2>Catways</h2>
  <ul id="catways-list"></ul>

  <h2>Utilisateurs</h2>
  <ul id="users-list"></ul>

  <script>
    // Récupérer le token depuis localStorage (qu’on a stocké après login)
    const token = localStorage.getItem('token');

    // Fetch et affichage des catways + réservations
    fetch('/catways', {
      headers: { 'Authorization': token }
    })
    .then(res => res.json())
    .then(catways => {
      const ul = document.getElementById('catways-list');
      catways.forEach(catway => {
        // Crée un li avec les infos du catway
        const li = document.createElement('li');
        li.innerHTML = `<strong>#${catway.catwayNumber}</strong> - Type: ${catway.catwayType} - État: ${catway.catwayState}`;

        // Conteneur pour les réservations
        const resList = document.createElement('ul');

        // Fetch des réservations pour ce catway
        fetch(`/catways/${catway._id}/reservations`, {
          headers: { 'Authorization': token }
        })
        .then(res => res.json())
        .then(reservations => {
          reservations.forEach(r => {
            const rLi = document.createElement('li');
            rLi.textContent = `${r.clientName} - ${r.boatName} (${new Date(r.startDate).toLocaleDateString()} → ${new Date(r.endDate).toLocaleDateString()})`;
            resList.appendChild(rLi);
          });
        })
        .catch(err => console.error('Erreur reservations:', err));

        li.appendChild(resList);
        ul.appendChild(li);
      });
    })
    .catch(err => console.error('Erreur catways:', err));


    // Fetch et affichage des users
    fetch('/users', {
      headers: { 'Authorization': token }
    })
    .then(res => res.json())
    .then(users => {
      const ul = document.getElementById('users-list');
      users.forEach(user => {
        const li = document.createElement('li');
        li.textContent = `${user.username} - ${user.email}`;
        ul.appendChild(li);
      });
    })
    .catch(err => console.error('Erreur users:', err));
  </script>
</body>
</html>